---
import Layout from "../layouts/Layout.astro";
import JobCard from "../components/JobCard.astro";
import SearchInput from '../components/SearchInput.astro'
import { AllJobs } from "./api/jobs/posts";
// import SearchPagination from "../components/SearchPagination.astro";
// import { JOBS_PER_PAGE } from "../constants";
import NoMatchingJobsCard from "../components/NoMatchingJobsCard.astro";

const query: string | null = Astro.url.searchParams.get('query');
const location: string | null = Astro.url.searchParams.get('location');

const Jobs = AllJobs;

//filter Jobs based on query

const SearchResult = Jobs.filter(job => {

    const TitleMatch: boolean = job.title
    .toLowerCase()
    .includes(query!.toLocaleLowerCase());

    const LocationMatch: boolean = job.center
    .toLowerCase()
    .includes(location!.toLocaleLowerCase());


    return TitleMatch && LocationMatch;

});


// const totalPages: number = Math.ceil(SearchResult.length / JOBS_PER_PAGE);

// const currentPage: number | null  = +Astro.url.searchParams.get('page')! || 1;

// const  JobsForPage = SearchResult.slice((currentPage - 1) * JOBS_PER_PAGE, currentPage * JOBS_PER_PAGE);
---

<Layout title={`Search | ` + query + ' - ' + location}>

    <SearchInput />

    <div class="items-center gap-12 shawdow-md">
        <div class="flex flex-col cards transition-all ease-in-out duration-300  max-w-[50rem] px-4 sm:px-3 lg:px-8 mx-auto pb-6">
            <div class="flex flex-col items-start gap-1">
                <!--<a href="/" class="inline-block bg-gray-100 p-2 mb-5 hover:bg-indigo-500 hover:text-white rounded-lg me-9">Back</a>-->
                <div class="flex flex-row items-center justify-evenly">
                    <span class="text-gray-600 dark:text-gray-400 py-3 text-sm font-semibold"><strong>Results for: </strong> {query} Jobs in {location} </span>
                    <span class={`ms-6 py-1 px-1.5 inline-flex items-center gap-x-1 text-xs font-medium ${SearchResult.length === 0 ? 'bg-rose-200 text-rose-800' : 'bg-teal-200 text-teal-800'} rounded-full dark:bg-teal-500/10 dark:text-teal-500`}>
                        <svg class="flex-shrink-0 w-3 h-3" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>
                        {SearchResult.length} Job post{SearchResult.length > 1 ? 's' : ''}
                      </span>
                </div>
            </div>
 
            {
                SearchResult.map(job =>
                    (
                        <JobCard job={job} />
                    )                  
                )
            }

            <NoMatchingJobsCard SearchResult={SearchResult} query={query!} location={location!} />
            <!-- <SearchPagination  currentPage={currentPage} totalPages={totalPages} disableNext={currentPage === totalPages} disablePrevious={currentPage === 1}/> -->
        </div>
    </div>
</Layout>